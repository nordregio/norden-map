<!doctype html>
<html data-theme="light">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>3D Nordic Population</title>
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    <link
      href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
     body {
       width: 100vw;
       height: 100vh;
       margin: 0;
       overflow: hidden;
       font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
     }

     #deck-container {
       width: 100vw;
       height: 100vh;
     }

     #deck-container canvas {
       z-index: 1;
       background: none;
     }

     .deck-widget {
       --button-size: 36px;
     }

     #menu-panel {
       position: absolute;
       top: 20px;
       right: 20px;
       width: 280px;
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(10px);
       border-radius: 12px;
       box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
       border: 1px solid rgba(0, 0, 0, 0.08);
       padding: 20px;
       z-index: 10;
       transition: all 0.3s ease;
       transform: translateX(0);
     }

     #menu-panel.hidden {
       transform: translateX(calc(100% + 40px));
     }

     #toggle-btn {
       position: absolute;
       top: 20px;
       right: 20px;
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(10px);
       border: 1px solid rgba(0, 0, 0, 0.08);
       border-radius: 8px;
       padding: 8px 12px;
       cursor: pointer;
       font-size: 12px;
       font-weight: 500;
       color: #374151;
       z-index: 11;
       display: none;
       box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
       transition: all 0.2s ease;
     }

     #toggle-btn:hover {
       background: rgba(255, 255, 255, 1);
       box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
     }

     #toggle-btn.show {
       display: block;
     }

     .panel-header {
       margin-bottom: 16px;
       padding-bottom: 12px;
       border-bottom: 1px solid rgba(0, 0, 0, 0.08);
     }

     .panel-title {
       font-size: 16px;
       font-weight: 600;
       color: #111827;
       margin: 0 0 4px 0;
     }

     .panel-subtitle {
       font-size: 12px;
       color: #6B7280;
       margin: 0;
     }

     .controls-section {
       margin-bottom: 20px;
     }

     .control-group {
       margin-bottom: 16px;
     }

     .control-label {
       display: block;
       font-size: 12px;
       font-weight: 500;
       color: #374151;
       margin-bottom: 8px;
     }

     .range-input {
       width: 100%;
       height: 4px;
       background: #E5E7EB;
       border-radius: 2px;
       outline: none;
       -webkit-appearance: none;
     }

     .range-input::-webkit-slider-thumb {
       -webkit-appearance: none;
       width: 16px;
       height: 16px;
       background: #2c5282;
       border-radius: 50%;
       cursor: pointer;
     }

     .range-input::-moz-range-thumb {
       width: 16px;
       height: 16px;
       background: #2c5282;
       border-radius: 50%;
       cursor: pointer;
       border: none;
     }

     .reset-btn {
       background: #F3F4F6;
       border: 1px solid #D1D5DB;
       border-radius: 6px;
       padding: 4px 8px;
       font-size: 11px;
       color: #374151;
       cursor: pointer;
       transition: all 0.2s ease;
     }

     .reset-btn:hover {
       background: #E5E7EB;
     }

     .info-section {
       font-size: 12px;
       line-height: 1.5;
       color: #4B5563;
     }

     kbd {
       display: inline-block;
       padding: 2px 4px;
       font-size: 0.8em;
       background-color: #f3f3f3;
       border: 1px solid #ccc;
       border-radius: 4px;
       box-shadow: inset 0 -1px 0 #bbb;
       color: #333;
     }

     .close-btn {
       position: absolute;
       top: 12px;
       right: 12px;
       background: none;
       border: none;
       font-size: 16px;
       color: #9CA3AF;
       cursor: pointer;
       width: 24px;
       height: 24px;
       display: flex;
       align-items: center;
       justify-content: center;
       border-radius: 4px;
       transition: all 0.2s ease;
     }

     .close-btn:hover {
       background: #F3F4F6;
       color: #374151;
     }

     @media (max-width: 768px) {
       #menu-panel {
         width: 260px;
         top: 16px;
         right: 16px;
         padding: 16px;
       }

       #toggle-btn {
         top: 16px;
         right: 16px;
       }
     }

     @media (max-width: 640px) {
       #menu-panel {
         width: calc(100vw - 32px);
         max-width: 300px;
       }
     }
    </style>
  </head>

  <body>
    <button id="toggle-btn" onclick="toggleMenu()">Show Info</button>

    <div id="menu-panel">
      <button class="close-btn" onclick="toggleMenu()">Ã—</button>

      <div class="panel-header">
        <h2 class="panel-title">Nordic Population</h2>
        <p class="panel-subtitle">3D population density visualization</p>
      </div>

      <div class="controls-section">
        <div class="control-group">
          <label class="control-label">
            Tune elevation scale
            <button class="reset-btn" onclick="resetElevation()" style="float: right;">Reset</button>
          </label>
          <input
            id="elevationScale"
            type="range"
            min="1"
            max="40"
            step="1"
            value="6"
            class="range-input"
          />
        </div>

        <div class="info-section">
          <p><strong>About this map:</strong> Each bar represents a 1km grid cell showing population density across the Nordic region. Bar height corresponds to the number of residents.</p>
          <p><strong>Why so clustered?</strong> Nearly all countries have an uneven population distribution across their territories, but the Nordic region is especially clustered. This is largely due to the location and physical geography of the Nordic region, with Norway, Sweden, and Finland having territory extending above the Arctic Circle.</p>
          <p>We invite you to peruse the map as users can zoom in and out and 'fly' around the Nordic Region. Get a close up of your favorite Nordic city or region. Or, play a game to see if you can name the city representing a cluster of bars in some distant Nordic region.</p>
          <p>Hold <kbd>CTRL</kbd> to rotate the map</p>
        </div>

      </div>

      <script>
       const {
         DeckGL,
         MapView,
         ColumnLayer,
         PolygonLayer,
         CompassWidget,
         ZoomWidget,
       } = deck;

       const polygon_layer = new PolygonLayer({
         id: "PolygonLayer",
         data: "layers/polygon_layer.json",
         pickable: false,
         getPolygon: (d) => d,
         filled: false,
         getLineColor: [211, 211, 211, 255],
         lineWidthMinPixels: 1,
       });

       function getTooltip({ object }) {
         return (
           object && {
             html: `${object.population} people<br><b>${object.munname}</b>`,
             style: {
               background: "rgba(255, 255, 255, 0.95)",
               color: "#374151",
               "font-family": '"Inter", Arial',
               "font-size": "11px",
               "border-radius": "6px",
               "padding": "8px 10px",
               "box-shadow": "0 4px 12px rgba(0, 0, 0, 0.15)",
               "border": "1px solid rgba(0, 0, 0, 0.08)",
             },
           }
         );
       }

       const deckgl = new DeckGL({
         map: maplibregl,
         mapStyle: "https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",
         initialViewState: {
           bearing: 0,
           latitude: 63,
           longitude: 23,
           maxZoom: 15,
           minZoom: 3,
           pitch: 80,
           zoom: 4,
         },
         views: [
           new MapView({
             id: "map",
             controller: true,
           }),
         ],
         layers: [],
         widgets: [
           new CompassWidget({
             id: "compass",
             viewId: "map",
           }),
           new ZoomWidget({
             id: "zoom",
             viewId: "map",
           }),
         ],
         getTooltip,
       });

       document.getElementById('elevationScale').oninput = renderLayer;
       renderLayer();

       function renderLayer() {
         const elevationScale = +document.getElementById('elevationScale').value;

         const column_layer = new ColumnLayer({
           id: "ColumnLayer",
           data: "layers/column_layer.json",
           extruded: true,
           radius: 500,
           pickable: true,
           autoHighlight: true,
           getPosition: (d) => [d.lng, d.lat],
           getElevation: (d) => d.population,
           getElevationWeight: (d) => d.population,
           getFillColor: (d) => d.fill_color,
           highlightColor: [59, 130, 246, 255],
           elevationScale: elevationScale
         });

         deckgl.setProps({
           layers: [polygon_layer, column_layer]
         });
       }

       function resetElevation() {
         document.getElementById('elevationScale').value = 6;
         renderLayer();
       }

       function toggleMenu() {
         const panel = document.getElementById('menu-panel');
         const toggleBtn = document.getElementById('toggle-btn');

         if (panel.classList.contains('hidden')) {
           panel.classList.remove('hidden');
           toggleBtn.classList.remove('show');
         } else {
           panel.classList.add('hidden');
           toggleBtn.classList.add('show');
         }
       }
      </script>
  </body>
</html>
